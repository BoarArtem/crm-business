generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String  @id @default(uuid())
  telegramId BigInt? @unique

  email    String @unique
  password String

  firstName String @map("first_name")
  lastName  String @map("last_name")

  businessQuantity Int        @default(0) @map("business_quantity")
  business         Business[] @relation("UserBusinesses")
  customers        Customer[] @relation("UserCustomers")

  deals Deal[] @relation("UserDeals")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user")
}

model Customer {
  id String @id @default(uuid())

  firstName String @map("first_name")
  lastName  String @map("last_name")
  email     String @unique

  userId String @map("user_id")
  user   User   @relation("UserCustomers", fields: [userId], references: [id])

  deals Deal[] @relation("CustomerDeals")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("customer")
}

model Business {
  id String @id @default(uuid())

  directorId String @map("director_id")
  director   User   @relation("UserBusinesses", fields: [directorId], references: [id])

  businessName           String @map("business_name")
  businessDescription    String @map("business_description")
  businessCapitalization Int    @map("business_capitalization")

  deals Deal[] @relation("BusinessDeals")

  @@map("business")
}

model Deal {
  id String @id @default(uuid())

  title       String
  description String?
  amount      Float   @default(0)
  currency    String  @default("USD")

  status DealStatus @default(NEW)

  directorId String
  director   User   @relation("UserDeals", fields: [directorId], references: [id])

  businessId String
  business   Business @relation("BusinessDeals", fields: [businessId], references: [id])

  customerId String
  customer   Customer @relation("CustomerDeals", fields: [customerId], references: [id])

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  closedAt  DateTime? @map("closed_at")

  @@map("deal")
}

enum DealStatus {
  NEW
  NEGOTIATION
  PROPOSAL
  CONTRACT
  WON
  LOST
}
